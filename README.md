# Sound Sphere Eng INFRA

➤ нужен для объединения подмодулей проекта


**1. У нас будет стандартный GitFlow:**
 - Если нужно реализовать новую фичу, откалываемся от dev ветки кодим, тестим локально, сливаем в dev там тестим и после отправляем в main
 - Если заруинили main - вводим hotfix ветку и правим баг
 - Имена веток выглядят примерно так **feat/CON-1-branch-name** / **fix/CON-1-branch-name** / **hotfix/CON-1-branch-name**
   Где CON-1 - это номер задачи из планировщика задач (напр. yougile)

**2. Среда деплоя:**

 - У нас будет всего **3 окружения**: LOCAL, DEV, PROD
 - LOCAL [HTTP] - запускается локально на хостовой машине (твой ноут) 
 - DEV [HTTPS] - развернут на VPS сервере в глобально сети на своем домене
 - PROD [HTTPS] - развернут на VPS сервере в глобально сети на своем домене


  **PROD:**
    Это окружение которое доступно по адресу: [sound-sphere-eng](https://sound-sphere-eng.xyz-avery.online/)
    Это продакшн среда на которм запущено уже итоговое протестированое приложение

  **DEV:**
    Это окружение для разработки/тестирования, адрес: [dev.sound-sphere-eng](https://dev.sound-sphere-eng.xyz-avery.online/)
    тут мы сливаем проверяем новые фичи, тестируем как это работает в HTTPS среде и есть ли аномалии и артефакты
    которых не было в локальной среде при разработке (т.к локальная среда может отличатся от билда + HTTPS)

  **LOCAL:**
    Это локальное окружение, оно доступно у нас локально на наших машинах
    Тут мы первостепенно уже разрабатываем фичи, после чего они едут на DEV а после всех тестов едут на PROD


  __Что такое эти окружения, как связать разработку и деплой?__

   Всё просто, у нас в репозиториях client и server будут по 2 ветки: **main** и **dev**
   т.е  **PROD -> main** | **DEV -> dev**
   Откалываемся от dev в ветку feat/CON-123-example делаем фичу, сливаем ее в dev, и эти изменения после git push автоматически применяются 
   на самом приложении в хосте DEV-окружения (ничего деплоить не нужно как раньше с FileZilla)


  __Как запустить локальную среду и начать работу?__

   1. стягиваем основной репозиторий по этой [ссылке](https://github.com/AveryOn/sound-sphere-eng-infra)
   2. находим в корне файл package.json и там есть команды запуска разных окружений, нас интересует команда **docker:local**
   3. выполняем в терминале **npm run docker:local** и запускается docker контейнер, (но придется установить docker + docker desktop на винде это не просто)
   4. Важно не забыть проставить **.env.local** файл в корень, значения для этого файла брать из **.env.example**
   5. если есть вопросы - ко мне.

**3. CI/CD:**
Как мы знаем, CI - непрерыаня интеграция, CD - непрерывное развертывание

потоу мы хотим сделать так, чтобы при выполнении команды **git push origin dev** наш проект развернутые в [dev.sound-sphere-eng](https://dev.sound-sphere-eng.xyz-avery.online/)
сразу же автоматически разворачивался, подтягивал зависимости, прогонял тесты и обновлялся без ручного деплоя и билда (npm run build)

Потому у нас будет такая схема:
1. сливаем что-то в **dev ветку**, github видит что произошел пуш в неё, отправляет вебхук на наш VPS на котором развернуты окружения 
    и VPS ловит этот вебхук и автоматически проводит интеграцию и деплой.
2. сливаем что-то в **main**, то же самое, но в отличае от **dev** ветки в том что мы не можем просто так запушить в неё, пока не все участники 
    проекта не проведут code-review, это такая защита продовой ветки от неожиданных изменений. 